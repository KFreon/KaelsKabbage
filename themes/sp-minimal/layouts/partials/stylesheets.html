{{ $cssOptions := cond (.Site.IsServer) (dict "enableSourceMap" false) (dict "outputStyle" "compressed") }}

{{ $stylesSCSS := resources.Get "assets/scss/mystyles.scss" }}
{{ $mobileSCSS := resources.Get "assets/scss/mobile.scss" }}
{{ $darkSCSS := resources.Get "assets/scss/dark.scss"}}

{{ $stylesCSS := $stylesSCSS | toCSS }} 
{{ $mobileCSS := $mobileSCSS | toCSS }} 
{{ $darkCSS := $darkSCSS | toCSS }} 

{{ $themeStylesCSS := resources.Get "themes/sp-minimal/static/css/styles.css" }}
{{ $minimalStylesCSS := resources.Get "themes/sp-minimal/static/css/sp-minimal.css" }}
{{ $minimalSimpleCSS := resources.Get "themes/sp-minimal/static/css/sp-minimal-simple.css" }}

{{ $combined := cond (eq .Site.Params.themeStyle "simple") 
  (slice $themeStylesCSS $minimalStylesCSS $minimalSimpleCSS $stylesCSS $mobileCSS $darkCSS) 
  (slice $themeStylesCSS $minimalStylesCSS $stylesCSS $mobileCSS $darkCSS) }}

{{ if .Site.IsServer }}
{{ range $combined }}
    <link rel="stylesheet" defer href="{{ .Permalink }}">
{{ end }}
{{ else }}
  {{ $styles := $combined | resources.Concat "css/stupid.css" | minify}} <!-- Hugo types are dumb (cos they're hidden) and I need to coerce it's type to the correct one -->
  <link rel="stylesheet" defer href="{{ $styles.Permalink }}">
{{ end }}