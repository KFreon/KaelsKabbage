{{- $pagePermalink := .Page.Permalink -}}
{{- $png := .Page.Resources.GetMatch (string (delimit (slice (.Get "path") ".png") "")) -}}
{{- with $png -}}
{{- $webp := .Process "webp q90" -}}

{{ $imageSizes := slice "320" "640" "960" "1280" "1920" }}
{{ $dataSizes := "(max-width: 960), 100% 50%" }}

<div class="media image" onclick="zoomImage(this)">
  <picture class="fullsize-frame media-frame">
      <source type="image/webp" srcset="
        {{- with $imageSizes -}}
            {{- range $i, $e := . -}}
                {{- if ge $png.Width . -}}
                    {{- if $i }}, {{ end -}}{{- ($png.Resize (printf "%sx%s" . " webp") ).RelPermalink }} {{ . }}w
                {{- end -}}
            {{- end -}}
        {{- end -}}"
        sizes="{{ $dataSizes }}"
    />

      <source type="image/jpg" srcset="
        {{- with $imageSizes -}}
            {{- range $i, $e := . -}}
                {{- if ge $png.Width . -}}
                    {{- if $i }}, {{ end -}}{{- ($png.Resize (printf "%sx%s" . " jpg") ).RelPermalink }} {{ . }}w
                {{- end -}}
            {{- end -}}
        {{- end -}}"
        sizes="{{ $dataSizes }}"
        />

      <img class="image inner" 
          src="{{ $png.Permalink }}"  
          width="{{ .Width }}" 
          height="{{ .Height }}"
          alt='{{ with $.Get "alt" }}{{ . }}{{ else }} "No Alt Text" {{ end }}' 
          loading="lazy" />
  </picture>

  <div class='alt-text-container'>
    {{- if in $pagePermalink "renders" -}}
    <a href='{{ $webp.Permalink }}'>Bigger</a>
    {{- end -}}
    <span class="alt-text">{{ $.Get "alt" }}</span>
    {{- if in $pagePermalink "renders" -}}
    <a href='{{ $png.Permalink }}'>PNG</a>
    {{- end -}}
  </div>
</div>
{{- end -}}