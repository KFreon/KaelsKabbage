<!-- // TODO: handle width/height automatically -->
<!-- // Renders? -->
<!-- https://www.brycewray.com/posts/2022/06/responsive-optimized-images-hugo/ -->


{{- $u := urls.Parse .Destination -}}
{{- $desc := .Text | safeHTML -}}
{{- $title := .Title -}}
{{- $pagePermalink := .Page.Permalink -}}
{{- if not $u.IsAbs -}}
  {{- with or (.Page.Resources.Get $u.Path) (resources.Get $u.Path) -}}
    {{- $png := . -}}
    {{- $webp := .Process "webp q90" -}}

<div class="media image" onclick="zoomImage(this)">
  <picture class="fullsize-frame media-frame">
      <source srcset='{{ $webp.Permalink }}' type="image/webp" width="{{.Width}}" height="{{.Height}}">
      <source srcset='{{ $png.Permalink }}' type="image/png" width="{{.Width}}" height="{{.Height}}"> 
      {{- with $png -}}
      <img class="image inner" 
          src="{{ .Permalink }}"  
          width="{{ .Width }}" 
          height="{{ .Height }}"
          alt="{{ $desc }}"
          loading="lazy" />
      {{- end -}}  
  </picture>

  <div class='alt-text-container'>
    {{- if in $pagePermalink "renders" -}}
    <a href='{{ $webp.Permalink }}'>Bigger</a>
    {{- end -}}
    <span class="alt-text">{{ $desc }}</span>
    {{- if in $pagePermalink "renders" -}}
    <a href='{{ $png.Permalink }}'>PNG</a>
    {{- end -}}
  </div>
</div>
  {{- end -}}
{{- else -}}
  <img src="{{ $u.String }}" />
{{- end -}}